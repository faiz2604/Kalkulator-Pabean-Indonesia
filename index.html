<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Informasi Kepabeanan Indonesia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(rgba(239, 246, 255, 0.96), rgba(239, 246, 255, 0.96)), url('https://images.unsplash.com/photo-1616434315428-91285c578f33?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
            background-color: rgba(255,255,255,0.8);
        }
        .nav-link {
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .nav-link.active {
            background-image: linear-gradient(to right, #4f46e5, #2563eb);
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 14px 0 rgb(0 118 255 / 39%);
        }
        .nav-link:not(.active):hover {
            background-color: #EFF6FF;
            color: #1D4ED8;
        }
        .lang-btn {
            padding: 0.25rem 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #D1D5DB;
            transition: background-color 0.2s, color 0.2s;
            cursor: pointer;
            font-weight: 500;
        }
        .lang-btn.active {
            background-color: #2563EB;
            color: white;
            border-color: #2563EB;
        }
        .page-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .page-content.active {
            display: block;
        }
        .section-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            margin-bottom: 1.5rem;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }
        .card-content {
            padding: 1.5rem;
        }
        .input-field {
            width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.5rem; transition: border-color 0.2s, box-shadow 0.2s; text-align: right;
        }
        .input-field:focus {
            outline: none; border-color: #3B82F6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        .input-field:disabled {
            background-color: #F3F4F6; cursor: not-allowed;
        }
        .btn {
            padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease-in-out; display: inline-flex; align-items: center; justify-content: center;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px 0 rgb(0 0 0 / 0.15);
        }
        .btn-primary { 
            background-image: linear-gradient(to right, #4f46e5, #2563eb); 
            color: white; 
        }
        .btn-primary:hover { 
            background-image: linear-gradient(to right, #4338ca, #1d4ed8);
        }
        .btn-secondary { background-color: #6B7280; color: white; }
        .btn-secondary:hover { background-color: #4B5563; }
        .btn-danger { background-color: #EF4444; color: white; }
        .btn-danger:hover { background-color: #DC2626; }
        .btn-export { background-color: #16A34A; color: white; }
        .btn-export:hover { background-color: #15803D; }
        .result-display {
            background-color: #F3F4F6; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; font-size: 1.125rem; font-weight: 600; color: #1F2937;
        }
        h1 { 
            font-size: 2.25rem; 
            font-weight: 800;
            background: linear-gradient(to right, #4f46e5, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @media (min-width: 768px) {
            h1 { font-size: 3rem; }
        }
        h2 { 
            font-size: 1.5rem; font-weight: 700; color: white;
            background-image: linear-gradient(to right, #3b82f6, #6366f1);
            padding: 1rem 1.5rem;
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            border-bottom: 1px solid #BFDBFE;
        }
        h3 { font-size: 1.25rem; font-weight: 600; color: #1F2937; margin-bottom: 1rem; border-bottom: 2px solid #E5E7EB; padding-bottom: 0.5rem; }
        table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
        th, td { text-align: left; padding: 0.75rem; border-bottom: 1px solid #E5E7EB; vertical-align: middle; }
        thead th { background-color: #F9FAFB; font-weight: 600; color: #374151; }
        tfoot td { 
            font-weight: 700;
            background-image: linear-gradient(to right, #dbeafe, #e0e7ff);
            color: #1e3a8a;
        }
        .text-right { text-align: right; }
        details > summary {
            cursor: pointer;
            font-weight: 500;
            color: #3B82F6;
        }
        #notification {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            background-color: #EF4444;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transform: translateX(200%);
            transition: transform 0.5s ease-in-out;
            z-index: 100;
        }
        #notification.show {
            transform: translateX(0);
        }
        /* --- QUIZ STYLES --- */
        .quiz-category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }
        .quiz-category-card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        .quiz-category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.05);
        }
        .quiz-question {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        .quiz-options label {
            display: block;
            background-color: #f9fafb;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            border: 1px solid #e5e7eb;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .quiz-options label:hover {
            background-color: #eff6ff;
            border-color: #93c5fd;
        }
        .quiz-options input[type="radio"]:checked + span {
            font-weight: 600;
            color: #2563eb;
        }
        .quiz-options input[type="radio"] {
            display: none;
        }
        .correct-answer {
            background-color: #dcfce7 !important;
            border-color: #4ade80 !important;
        }
        .wrong-answer {
            background-color: #fee2e2 !important;
            border-color: #f87171 !important;
        }
        .essay-answer {
            width: 100%;
            min-height: 150px;
        }
        .model-answer {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f0f9ff;
            border-left: 4px solid #38bdf8;
            border-radius: 0.25rem;
        }

    </style>
</head>
<body>

    <div class="sticky-header shadow-md mb-8">
        <div class="container mx-auto p-4 max-w-7xl">
            <header class="text-center md:text-left flex flex-col md:flex-row justify-between items-center">
                <h1 class="font-bold text-gray-800" data-lang-key="portal_title">Portal Informasi Kepabeanan Indonesia</h1>
                <div class="flex space-x-2 mt-2 md:mt-0">
                    <button id="lang-id" class="lang-btn active" onclick="setLanguage('id')">ID</button>
                    <button id="lang-en" class="lang-btn" onclick="setLanguage('en')">EN</button>
                </div>
            </header>
            <!-- Navigation -->
            <nav class="bg-white/0 mt-4 flex flex-wrap gap-2 justify-center">
                <a class="nav-link active" onclick="showPage('kalkulator')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.5 2A1.5 1.5 0 004 3.5v13A1.5 1.5 0 005.5 18h9a1.5 1.5 0 001.5-1.5v-13A1.5 1.5 0 0014.5 2h-9zM5 3.5a.5.5 0 01.5-.5h9a.5.5 0 01.5.5v13a.5.5 0 01-.5.5h-9a.5.5 0 01-.5-.5v-13z" clip-rule="evenodd" /><path d="M6.75 6a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z" /><path d="M6.75 9.5a.75.75 0 000 1.5h3.5a.75.75 0 000-1.5h-3.5z" /></svg><span data-lang-key="nav_calculators">Kalkulator</span></a>
                <a class="nav-link" onclick="showPage('kuota-impor')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H4zm3.5 4.5a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0v-5.5zM9.25 6a.75.75 0 00-1.5 0v8a.75.75 0 001.5 0v-8zm3.5.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5z" clip-rule="evenodd" /></svg><span data-lang-key="nav_import_quota">Kuota Impor</span></a>
                <a class="nav-link" onclick="showPage('fasilitas')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 2.75a.75.75 0 00-1.5 0v8.25a.75.75 0 001.5 0V2.75z" /><path fill-rule="evenodd" d="M3.235 10.213a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.06 0l2.25-2.25a.75.75 0 00-1.06-1.06L5 11.94V10.5a.75.75 0 00-.75-.75h-1.5a.75.75 0 00-.75.75v1.44l-1.215-1.214zM10 10.5a.75.75 0 01.75-.75h1.5a.75.75 0 01.75.75v4.25a.75.75 0 01-1.5 0V10.5zM15.5 9.75a.75.75 0 00-.75.75v1.44l-1.215-1.214a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.06 0l2.25-2.25a.75.75 0 10-1.06-1.06L16.5 11.94V10.5a.75.75 0 00-.75-.75h-1.5z" clip-rule="evenodd" /></svg><span data-lang-key="nav_facilities">Analisis Fasilitas</span></a>
                <a class="nav-link" onclick="showPage('studi-kasus')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" /></svg><span data-lang-key="nav_case_studies">Studi Kasus</span></a>
                <a class="nav-link" onclick="showPage('peraturan')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3.5 2A1.5 1.5 0 002 3.5v13A1.5 1.5 0 003.5 18h13a1.5 1.5 0 001.5-1.5V6.857a1.5 1.5 0 00-.44-1.06l-4.857-4.857A1.5 1.5 0 0011.857 2H3.5zM11 5V2.5L15.5 7H12.5a1.5 1.5 0 01-1.5-1.5z" /></svg><span data-lang-key="nav_regulations">Pusat Peraturan</span></a>
                <a class="nav-link" onclick="showPage('glosarium')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M3.5 2A1.5 1.5 0 002 3.5v12A1.5 1.5 0 003.5 17h1.5v1.167a.75.75 0 001.29.53l2.433-2.433A.75.75 0 019.207 16H16.5a1.5 1.5 0 001.5-1.5v-11A1.5 1.5 0 0016.5 2h-13z" /></svg><span data-lang-key="nav_glossary">Glosarium</span></a>
                <a class="nav-link" onclick="showPage('kuis')"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.5-2.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 12a5.99 5.99 0 00-4.793 2.39A6.483 6.483 0 0010 16.5a6.483 6.483 0 004.793-2.11A5.99 5.99 0 0010 12z" clip-rule="evenodd" /></svg><span data-lang-key="nav_quiz">Kuis Pabean</span></a>
            </nav>
        </div>
    </div>

    <div class="container mx-auto p-4 md:px-8 max-w-7xl">
        <!-- Page Content -->
        <main>
            <!-- Kalkulator Page -->
            <div id="kalkulator" class="page-content active">
                <div class="section-card">
                    <h2 data-lang-key="kalkulator_pib_title">Kalkulator PIB (Termasuk Bea Masuk Anti Dumping)</h2>
                    <div class="card-content">
                        <details class="mb-4 bg-blue-50 p-4 rounded-lg">
                            <summary data-lang-key="pib_guidance_summary">Tampilkan Petunjuk Pengisian</summary>
                            <div class="mt-2 text-sm text-gray-700 space-y-2" data-lang-key="pib_guidance_content">
                                <p><strong>Total Insurance:</strong> Masukkan total biaya asuransi pengiriman barang dari luar negeri.</p>
                                <p><strong>Total Freight:</strong> Masukkan total biaya pengangkutan/pengiriman barang (ongkos kirim).</p>
                                <p><strong>Total Royalty & Lisensi:</strong> Biaya yang harus dibayar sebagai syarat penjualan barang impor (jika ada).</p>
                                <p><strong>Total Garansi:</strong> Biaya penggantian atau perbaikan yang ditanggung pembeli (jika ada).</p>
                                <p><strong>Total Diskon:</strong> Potongan harga yang didapat dari total nilai barang.</p>
                                <p><strong>Cost Barang:</strong> Masukkan harga per-item/per-jenis barang sesuai invoice.</p>
                                <p><strong>Tarif BM & BMAD:</strong> Masukkan tarif Bea Masuk dan Bea Masuk Anti Dumping dalam persen (%). Isi 0 jika tidak ada.</p>
                            </div>
                        </details>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 border-b pb-6 mb-6">
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="pib-number" data-lang-key="label_pib_number">Nomor PIB</label><input type="text" id="pib-number" class="input-field !text-left" placeholder="000123-20250725-123456"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="main-insurance" data-lang-key="label_total_insurance">Total Insurance (Rp)</label><input type="text" id="main-insurance" class="input-field number-input" placeholder="150.000" inputmode="numeric"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="main-freight" data-lang-key="label_total_freight">Total Freight (Rp)</label><input type="text" id="main-freight" class="input-field number-input" placeholder="1.500.000" inputmode="numeric"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="main-royalty" data-lang-key="label_total_royalty">Total Royalty & Lisensi (Rp)</label><input type="text" id="main-royalty" class="input-field number-input" placeholder="0" inputmode="numeric"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="main-warranty" data-lang-key="label_total_warranty">Total Garansi (Rp)</label><input type="text" id="main-warranty" class="input-field number-input" placeholder="0" inputmode="numeric"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="main-discount" data-lang-key="label_total_discount">Total Diskon (Rp)</label><input type="text" id="main-discount" class="input-field number-input" placeholder="0" inputmode="numeric"></div>
                            <div><label class="block text-sm font-medium text-gray-700 mb-1" for="main-pph-tarif" data-lang-key="label_pph_rate">Tarif PPh Ps. 22</label><select id="main-pph-tarif" class="input-field !text-left"><option value="0.025" data-lang-key="pph_option_1">2,5% (Dengan API)</option><option value="0.075" data-lang-key="pph_option_2">7,5% (Tanpa API)</option><option value="0.1" data-lang-key="pph_option_3">10% (Tertentu)</option><option value="0.005" data-lang-key="pph_option_4">0,5% (Tertentu)</option></select></div>
                        </div>
                        
                        <div class="hidden md:grid md:grid-cols-12 gap-4 px-4 py-2 text-sm font-semibold text-gray-600 bg-gray-50 rounded-t-lg">
                            <div class="md:col-span-1" data-lang-key="th_serial">Serial</div>
                            <div class="md:col-span-5" data-lang-key="th_item_cost">Cost Barang (Rp)</div>
                            <div class="md:col-span-2" data-lang-key="th_bm_rate">Tarif BM (%)</div>
                            <div class="md:col-span-2" data-lang-key="th_bmad_rate">Tarif BMAD (%)</div>
                            <div class="md:col-span-2" data-lang-key="th_action">Aksi</div>
                        </div>
                        <div id="items-container" class="space-y-4 md:space-y-0"></div>

                        <button id="add-item-btn" class="btn btn-primary mt-4"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" /></svg><span data-lang-key="btn_add_item">Tambah Barang</span></button><hr class="my-6"><div class="flex flex-wrap gap-4"><button onclick="calculateMain()" class="btn btn-primary text-lg" data-lang-key="btn_calculate_pib">Hitung & Detailkan PIB</button><button onclick="resetMain()" class="btn btn-secondary" data-lang-key="btn_reset">Reset</button></div>
                        <div id="pib-results-detail" class="mt-4 hidden"><h3 class="text-lg font-semibold mb-2" data-lang-key="pib_result_title">Detail Perhitungan PIB</h3><div class="overflow-x-auto"><table id="pib-results-table"><thead><tr><th data-lang-key="th_serial">Serial</th><th class="text-right" data-lang-key="th_customs_value">Nilai Pabean</th><th class="text-right" data-lang-key="th_import_duty">Bea Masuk</th><th class="text-right" data-lang-key="th_add">BM Anti Dumping</th><th class="text-right" data-lang-key="th_import_value">Nilai Impor</th><th class="text-right" data-lang-key="th_vat">PPN</th><th class="text-right" data-lang-key="th_pph22">PPh 22</th></tr></thead><tbody id="pib-results-body"></tbody><tfoot id="pib-results-foot"></tfoot></table></div><div class="flex flex-wrap gap-4 mt-4"><button onclick="exportPIB('xlsx')" class="btn btn-export"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M2.5 2A1.5 1.5 0 001 3.5v13A1.5 1.5 0 002.5 18h15a1.5 1.5 0 001.5-1.5v-13A1.5 1.5 0 0017.5 2h-15zM2 3.5a.5.5 0 01.5-.5h15a.5.5 0 01.5.5v13a.5.5 0 01-.5.5h-15a.5.5 0 01-.5-.5v-13z" /><path d="M12.5 12.5a.5.5 0 01-.5.5h-2a.5.5 0 010-1h2a.5.5 0 01.5.5zM10 10a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2A.5.5 0 0110 10zM7.5 6a.5.5 0 01.5.5v7a.5.5 0 01-1 0v-7a.5.5 0 01.5-.5zM12 6.5a.5.5 0 00-1 0v2a.5.5 0 001 0v-2z" /></svg><span data-lang-key="btn_export_excel">Export ke Excel</span></button><button onclick="exportPIB('csv')" class="btn btn-export"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zM8.23 6.023a.75.75 0 011.06 0l3.25 3.25a.75.75 0 010 1.06l-3.25 3.25a.75.75 0 11-1.06-1.06L10.94 10 8.23 7.083a.75.75 0 010-1.06z" clip-rule="evenodd" /></svg><span data-lang-key="btn_export_csv">Export ke CSV</span></button></div></div>
                        <div id="pib-calculation-explanation" class="mt-6 hidden bg-gray-50 p-4 rounded-lg"></div>
                    </div>
                </div>
                <div class="section-card"><h2 data-lang-key="kalkulator_sanksi_title">Kalkulator Sanksi Administrasi</h2><div class="card-content"><div id="sanksi-placeholder" class="text-center p-8 bg-gray-100 rounded-lg"><p class="text-gray-600 font-medium" data-lang-key="sanksi_placeholder">Lengkapi dan hitung detail PIB di atas terlebih dahulu untuk mengaktifkan kalkulator sanksi.</p></div><div id="sanksi-content" class="hidden"><div class="grid grid-cols-1 md:grid-cols-2 gap-x-6"><div class="input-group"><label class="block text-sm font-medium text-gray-700 mb-1" for="sanksi-jenis-pelanggaran" data-lang-key="label_error_type">Jenis Kesalahan</label><select id="sanksi-jenis-pelanggaran" class="input-field !text-left" onchange="toggleSanksiInput()"><option value="nilai_pabean" data-lang-key="error_type_value">Kesalahan Nilai Pabean</option><option value="tarif" data-lang-key="error_type_rate">Kesalahan Tarif</option></select></div><div class="input-group"><label class="block text-sm font-medium text-gray-700 mb-1" for="sanksi-jenis-importir" data-lang-key="label_importer_type">Jenis Importir</label><select id="sanksi-jenis-importir" class="input-field !text-left"><option value="umum" data-lang-key="importer_type_general">Importir Umum</option><option value="fasilitas" data-lang-key="importer_type_facility">Importir Fasilitas (AEO/MITA/Kawasan Berikat/KITE)*</option></select></div></div><div class="overflow-x-auto"><table id="sanksi-input-table"><thead></thead><tbody id="sanksi-items-container"></tbody></table></div><p class="text-xs text-gray-500 mt-2 mb-4" data-lang-key="sanksi_note">*Skema denda berjenjang akan diterapkan otomatis sesuai aturan.</p><button onclick="calculateSanksi()" class="btn btn-primary" data-lang-key="btn_calculate_sanction">Hitung Sanksi</button><div id="sanksi-result-container" class="mt-4 space-y-2 hidden"><div class="result-display"><span data-lang-key="sanksi_result_paid">Total BM Dibayar</span>: <span id="sanksi-total-bm-dibayar"></span></div><div class="result-display"><span data-lang-key="sanksi_result_should_be">Total BM Seharusnya</span>: <span id="sanksi-total-bm-seharusnya"></span></div><div class="result-display"><span data-lang-key="sanksi_result_shortage">Kekurangan Pembayaran BM</span>: <span id="sanksi-result-kurang"></span></div><div class="result-display"><span data-lang-key="sanksi_result_percentage">Persentase Kekurangan</span>: <span id="sanksi-result-persen"></span></div><div class="result-display"><span data-lang-key="sanksi_result_applicable_rate">Tarif Denda Berlaku</span>: <span id="sanksi-result-tarif"></span></div><div class="result-display bg-red-100 text-red-800"><strong data-lang-key="sanksi_result_total_fine">Total Denda</strong>: <span id="sanksi-result-denda"></span></div><div class="flex flex-wrap gap-4 mt-4"><button onclick="exportSanksi('xlsx')" class="btn btn-export" data-lang-key="btn_export_excel">Export ke Excel</button><button onclick="exportSanksi('csv')" class="btn btn-export" data-lang-key="btn_export_csv">Export ke CSV</button></div></div></div></div></div>
                <div class="section-card"><h2>Kalkulator Impor Sementara</h2><div class="card-content"><p data-lang-key="temp_import_desc">Simulasikan pembayaran untuk impor sementara. Masukkan total pungutan yang seharusnya dibayar jika impor biasa, dan jangka waktu penggunaan.</p><div class="grid grid-cols-1 md:grid-cols-2 gap-x-6"><div class="input-group"><label class="block text-sm font-medium text-gray-700 mb-1" for="is-bm" data-lang-key="label_total_bm_should_be">Total Bea Masuk Seharusnya (Rp)</label><input type="text" id="is-bm" class="input-field number-input" placeholder="18.462.500" inputmode="numeric"></div><div class="input-group"><label class="block text-sm font-medium text-gray-700 mb-1" for="is-ppn" data-lang-key="label_total_vat_should_be">Total PPN Seharusnya (Rp)</label><input type="text" id="is-ppn" class="input-field number-input" placeholder="25.240.875" inputmode="numeric"></div><div class="input-group"><label class="block text-sm font-medium text-gray-700 mb-1" for="is-pph" data-lang-key="label_total_pph_should_be">Total PPh 22 Seharusnya (Rp)</label><input type="text" id="is-pph" class="input-field number-input" placeholder="5.736.563" inputmode="numeric"></div><div class="input-group"><label class="block text-sm font-medium text-gray-700 mb-1" for="is-jw" data-lang-key="label_period_months">Jangka Waktu (Bulan)</label><input type="number" id="is-jw" class="input-field" placeholder="12" inputmode="numeric"></div></div><button onclick="calculateImporSementara()" class="btn btn-primary" data-lang-key="btn_calculate_temp_import">Hitung Impor Sementara</button><div id="is-result-container" class="mt-4 space-y-2 hidden"><div class="result-display"><span data-lang-key="temp_import_total_levies">Total Pungutan Seharusnya</span>: <span id="is-total-pungutan"></span></div><div class="result-display"><span data-lang-key="temp_import_monthly_payment">Pembayaran per Bulan (2%)</span>: <span id="is-per-bulan"></span></div><div class="result-display bg-blue-100 text-blue-800"><strong data-lang-key="temp_import_total_payment">Total Bayar Impor Sementara</strong>: <span id="is-total-bayar"></span></div></div></div></div>
            </div>

            <!-- Kuota Impor Page -->
            <div id="kuota-impor" class="page-content"><div class="section-card"><h2 data-lang-key="quota_title">Syarat Kuota Impor (Permendag 16-24 Tahun 2025)</h2><div class="card-content space-y-4 text-gray-700" data-lang-key="quota_content"><p>Pada pertengahan tahun 2025, Kementerian Perdagangan melakukan perombakan kebijakan impor dengan menerbitkan serangkaian peraturan baru (Permendag No. 16/2025 hingga 24/2025). Kebijakan ini mengakhiri era relaksasi impor di bawah Permendag 8/2024 dan kembali memberlakukan syarat <strong>Persetujuan Impor (PI)</strong> dan <strong>Laporan Surveyor (LS)</strong> untuk berbagai komoditas strategis. Tujuannya adalah untuk melindungi industri dalam negeri, menekan impor ilegal, dan menjaga neraca perdagangan.</p><h3>Syarat Umum Pengajuan Persetujuan Impor (PI)</h3><p>Secara umum, perusahaan yang ingin mendapatkan kuota impor (dalam bentuk PI) harus memenuhi persyaratan fundamental sebagai berikut:</p><ul class="list-disc list-inside space-y-2"><li><strong>Legalitas Usaha yang Valid:</strong> Memiliki Nomor Induk Berusaha (NIB) yang masih berlaku sebagai Angka Pengenal Importir (API).</li><li><strong>Izin Usaha Terkait:</strong> Memiliki izin usaha di sektornya masing-masing (misalnya, Izin Usaha Industri untuk importir produsen).</li><li><strong>Rencana Kebutuhan Impor:</strong> Mengajukan rencana kebutuhan barang impor untuk periode tertentu (biasanya satu tahun), yang didukung oleh data kapasitas produksi atau rencana penjualan.</li><li><strong>Laporan Realisasi Impor:</strong> Menyerahkan laporan realisasi impor dari periode sebelumnya sebagai bukti kepatuhan dan akuntabilitas.</li><li><strong>Dokumen Pendukung Lainnya:</strong> Tergantung komoditasnya, mungkin diperlukan dokumen tambahan seperti rekomendasi dari kementerian teknis (misal: Kemenperin).</li></ul><h3>Highlight Peraturan Spesifik (Contoh)</h3><p>Setiap peraturan memiliki fokusnya masing-masing:</p><ul class="list-disc list-inside space-y-2"><li><strong>Permendag 16/2025:</strong> Umumnya menjadi peraturan payung yang mengembalikan syarat PI untuk barang konsumsi yang sebelumnya dibebaskan, seperti <strong>Elektronik, Alas Kaki, Pakaian Jadi, dan Mainan Anak</strong>. Pengetatan ini bertujuan langsung untuk membendung serbuan produk impor jadi.</li><li><strong>Permendag Lainnya (Seri 17-24/2025):</strong> Peraturan-peraturan ini biasanya mengatur komoditas yang lebih spesifik dan krusial bagi industri, seperti:<ul><li>- <strong>Besi atau Baja:</strong> Memerlukan pertimbangan teknis dari Kemenperin terkait kebutuhan proyek dan industri nasional.</li><li>- <strong>Produk Tekstil dan Turunannya (TPT):</strong> Syarat PI diperketat untuk melindungi industri TPT dalam negeri dari hulu hingga hilir.</li><li>- <strong>Produk Kimia dan Bahan Berbahaya:</strong> Memerlukan verifikasi keamanan dan rekomendasi dari instansi terkait.</li></ul></li></ul><h3>Alur Proses Pengajuan</h3><p>Proses pengajuan PI dilakukan secara digital melalui portal <strong>INSW (Indonesia National Single Window)</strong> dan sistem <strong>SIINas (Sistem Informasi Industri Nasional)</strong>. Secara garis besar, alurnya adalah:<ol class="list-decimal list-inside space-y-2"><li>Perusahaan mengajukan permohonan secara online dengan melengkapi data dan dokumen yang dipersyaratkan.</li><li>Sistem akan melakukan verifikasi awal. Jika komoditas memerlukan rekomendasi teknis, permohonan akan diteruskan ke kementerian terkait (misal: Kemenperin).</li><li>Setelah mendapatkan rekomendasi (jika perlu), Kementerian Perdagangan akan melakukan verifikasi akhir.</li><li>Jika semua syarat terpenuhi, Kemendag akan menerbitkan Persetujuan Impor (PI) yang berisi kuota jumlah dan jenis barang yang boleh diimpor.</li></ol></div></div></div>

            <!-- Fasilitas Page -->
            <div id="fasilitas" class="page-content"><div class="section-card"><h2 data-lang-key="facilities_title">Analisis Fasilitas Kepabeanan</h2><div class="card-content space-y-6 text-gray-700" data-lang-key="facilities_content"><div><h3>Kawasan Berikat (KB)</h3><p>Tempat penimbunan berikat untuk menimbun barang impor dan/atau barang yang berasal dari tempat lain dalam daerah pabean guna diolah ataupun digabungkan, yang hasilnya terutama untuk diekspor.</p><p><strong>Analisis & Manfaat:</strong> Penangguhan Bea Masuk dan tidak dipungut PDRI atas impor bahan baku. Sangat membantu arus kas (cash flow) perusahaan manufaktur berorientasi ekspor.</p></div><div><h3>Gudang Berikat (GB)</h3><p>Tempat penimbunan berikat untuk menimbun barang impor, dapat disertai 1 atau lebih kegiatan berupa pengemasan/pengemasan kembali, penyortiran, penggabungan (kitting), pengepakan, penyetelan, pemotongan, atas barang-barang tertentu dalam jangka waktu tertentu untuk dikeluarkan kembali.</p><p><strong>Analisis & Manfaat:</strong> Sama seperti KB, mendapat penangguhan BM dan tidak dipungut PDRI. Cocok untuk industri yang butuh pusat distribusi logistik bahan baku impor di dekat lokasi industrinya.</p></div><div><h3>Pusat Logistik Berikat (PLB)</h3><p>Tempat penimbunan berikat untuk menimbun barang asal luar daerah pabean dan/atau barang yang berasal dari tempat lain dalam daerah pabean, dapat disertai 1 atau lebih kegiatan sederhana dalam jangka waktu tertentu untuk dikeluarkan kembali.</p><p><strong>Analisis & Manfaat:</strong> Menjadikan Indonesia sebagai hub logistik di Asia Pasifik. Importir dapat menimbun barang di PLB dengan penangguhan BM & PDRI, mendekatkan bahan baku dengan pabrik tanpa harus langsung melakukan proses impor penuh.</p></div><div><h3>Kawasan Bebas (Free Trade Zone)</h3><p>Suatu kawasan yang berada dalam wilayah hukum NKRI yang terpisah dari daerah pabean sehingga bebas dari pengenaan Bea Masuk, PPN, PPnBM, dan Cukai. Contoh: Batam, Bintan, Karimun.</p><p><strong>Analisis & Manfaat:</strong> Pemasukan barang konsumsi dari luar negeri ke Kawasan Bebas tidak dipungut BM & PDRI. Ini bertujuan untuk mendorong kegiatan ekonomi, pariwisata, dan perdagangan di wilayah perbatasan.</p></div><div><h3>Kemudahan Impor Tujuan Ekspor (KITE)</h3><p>Fasilitas pembebasan atau pengembalian Bea Masuk dan PPN tidak dipungut atas impor bahan baku untuk diolah, dirakit, atau dipasang pada barang lain dengan tujuan untuk diekspor.</p><p><strong>Analisis & Manfaat:</strong> Membuat harga produk ekspor lebih kompetitif. Berbeda dengan KB, perusahaan KITE tidak harus berada di kawasan khusus, memberikan fleksibilitas lokasi yang lebih tinggi.</p></div><div><h3>Mitra Utama Kepabeanan (MITA) & Authorized Economic Operator (AEO)</h3><p>Status pengakuan oleh DJBC kepada perusahaan dengan rekam jejak kepatuhan yang sangat baik. AEO memiliki standar lebih tinggi dan diakui secara internasional.</p><p><strong>Analisis & Manfaat:</strong> Mendapatkan perlakuan "karpet merah" berupa penyederhanaan prosedur, pemeriksaan fisik minim (jalur hijau), dan proses pengeluaran barang yang sangat cepat. Mengurangi waktu dan biaya logistik secara signifikan.</p></div><div><h3>Toko Bebas Bea (TBB / Duty Free Shop)</h3><p>Bangunan yang berlokasi di kawasan pabean di bandar udara internasional atau pelabuhan utama untuk menjual barang asal impor kepada orang yang bepergian ke luar negeri.</p><p><strong>Analisis & Manfaat:</strong> Memberikan fasilitas kepada wisatawan atau penumpang untuk membeli barang impor tanpa dikenai BM dan PDRI, sebagai salah satu daya tarik dalam industri pariwisata.</p></div><div><h3>Barang Penumpang & Barang Kiriman</h3><p>Fasilitas pembebasan bea masuk yang diberikan kepada individu. <strong>Barang Penumpang</strong> adalah barang pribadi yang dibawa dari luar negeri (saat ini de minimis USD 500 per orang). <strong>Barang Kiriman</strong> adalah barang yang dikirim melalui Penyelenggara Pos (misal: e-commerce) dengan de minimis saat ini USD 3 per kiriman.</p><p><strong>Analisis & Manfaat:</strong> Memudahkan masyarakat untuk membawa atau menerima barang dari luar negeri untuk keperluan pribadi dalam batas nilai tertentu tanpa melalui proses impor yang rumit.</p></div><div><h3>Pemanfaatan Free Trade Agreement (FTA)</h3><p>FTA adalah perjanjian perdagangan bebas antar negara yang memungkinkan importir mendapatkan keringanan atau pembebasan Bea Masuk (tarif preferensi). Untuk memanfaatkannya, importir harus membuktikan bahwa barangnya berasal dari negara mitra FTA.</p><p><strong>Kriteria Utama yang Harus Dipenuhi:</strong></p><ul class="list-disc list-inside space-y-2"><li><strong>Rules of Origin (Ketentuan Asal Barang):</strong> Barang harus memenuhi kriteria asal barang yang ditetapkan dalam perjanjian. Ini bisa berarti barang tersebut sepenuhnya diperoleh/diproduksi di negara mitra (Wholly Obtained), atau telah melalui proses pengerjaan yang substansial (Substantial Transformation) yang diukur dengan persentase kandungan lokal atau perubahan klasifikasi HS Code.</li><li><strong>Surat Keterangan Asal (SKA) / Certificate of Origin (COO):</strong> Importir wajib melampirkan SKA (Form D untuk ATIGA, Form E untuk ACFTA, dll.) yang valid. Dokumen ini diterbitkan oleh instansi berwenang di negara pengekspor dan menjadi bukti utama bahwa barang memenuhi Rules of Origin.</li><li><strong>Ketentuan Pengiriman Langsung (Direct Consignment):</strong> Barang harus dikirimkan secara langsung dari negara pengekspor ke Indonesia. Transit di negara lain diperbolehkan selama tidak ada proses pengerjaan lebih lanjut (hanya bongkar muat) dan tetap dalam pengawasan pabean di negara transit.</li><li><strong>Ketentuan Prosedural:</strong> Importir harus mencantumkan nomor referensi SKA dan kode fasilitas pada dokumen Pemberitahuan Impor Barang (PIB). Selain itu, importir wajib menyimpan semua dokumen terkait impor dengan skema FTA selama periode tertentu untuk keperluan audit atau verifikasi oleh DJBC di kemudian hari.</li></ul></div></div></div></div>
            
            <!-- Studi Kasus Page -->
            <div id="studi-kasus" class="page-content"><div class="section-card"><h2 data-lang-key="case_studies_title">Studi Kasus Kepabeanan</h2><div class="card-content space-y-6 text-gray-700" data-lang-key="case_studies_content"><div><h3>Kasus 1: Impor Multi-Item dengan BM Anti Dumping</h3><p>PT ABC mengimpor 2 jenis barang dari negara X. Perusahaan memiliki API. Salah satu barang dikenakan BMAD.</p><ul class="list-disc list-inside"><li>Total Insurance: Rp 2.000.000, Total Freight: Rp 15.000.000</li><li>Barang 1: 100 unit Komponen Mesin, Cost: Rp 200.000.000, Tarif BM: 10%, Tarif BMAD: 0%</li><li>Barang 2: 50 unit Plat Baja, Cost: Rp 50.000.000, Tarif BM: 5%, Tarif BMAD: 15%</li></ul><p><strong>Perhitungan:</strong> Kalkulator akan mengalokasikan Insurance & Freight secara proporsional, lalu menghitung BM dan BMAD untuk setiap item. Hasilnya akan menunjukkan total pungutan yang harus dibayar, dengan BM dan BMAD sebagai komponen terpisah.</p></div><div><h3>Kasus 2: Sanksi Denda Akibat Kesalahan Nilai Pabean</h3><p>Setelah melakukan impor pada Kasus 1, PT ABC diaudit oleh DJBC dan ditemukan bahwa Nilai Pabean untuk Komponen Mesin seharusnya lebih tinggi.</p><ul class="list-disc list-inside"><li>BM yang sudah dibayar (total): Rp 22.100.000</li><li>Hasil Audit: Nilai Pabean Komponen Mesin seharusnya Rp 220.000.000 (bukan Rp 203.400.000).</li><li>BM Seharusnya: (Rp 220.000.000 * 10%) + BM Plat Baja = Rp 22.000.000 + Rp 2.600.000 = Rp 24.600.000</li><li>Kekurangan Bayar: Rp 2.500.000</li></ul><p><strong>Perhitungan Sanksi:</strong> Kalkulator akan menghitung persentase kekurangan (Rp 2.5jt / Rp 22.1jt = 11,3%). Karena di bawah 25%, denda untuk importir umum adalah 100% dari kekurangan, yaitu Rp 2.500.000.</p></div><div><h3>Kasus 3: Sengketa Klasifikasi Barang (HS Code)</h3><p>PT DEF mengimpor "Mesin Pengolah Data Otomatis" dan memberitahukannya dalam PIB dengan HS Code 8471.50.00 (Tarif BM 0%). Setelah diperiksa, Pejabat Bea Cukai menetapkan bahwa barang tersebut lebih tepat diklasifikasikan sebagai "Peralatan Telekomunikasi" dengan HS Code 8517.62.00 (Tarif BM 5%).</p><ul class="list-disc list-inside"><li>Nilai Pabean Barang: Rp 500.000.000</li><li>BM yang dibayar (menurut importir): Rp 500.000.000 * 0% = Rp 0</li><li>BM Seharusnya (menurut DJBC): Rp 500.000.000 * 5% = Rp 25.000.000</li><li>Kekurangan Bayar BM: Rp 25.000.000</li></ul><p><strong>Konsekuensi:</strong> PT DEF harus membayar kekurangan BM sebesar Rp 25.000.000. Selain itu, karena terjadi kesalahan pemberitahuan yang menyebabkan kekurangan bayar, PT DEF juga akan dikenakan sanksi administrasi berupa denda sesuai ketentuan yang berlaku.</p></div></div></div></div>

            <!-- Peraturan Page -->
            <div id="peraturan" class="page-content"><div class="section-card"><h2 data-lang-key="regulations_title">Pusat Peraturan</h2><div class="card-content space-y-6" data-lang-key="regulations_content"><div><h3>Undang-Undang</h3><ul class="list-disc list-inside text-blue-600"><li><a href="https://peraturan.bpk.go.id/Details/39267/uu-no-17-tahun-2006" target="_blank" rel="noopener noreferrer">UU No. 17 Tahun 2006 (Kepabeanan)</a></li><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/439ec12d-3715-4b73-929a-25b411a3b934" target="_blank" rel="noopener noreferrer">UU No. 7 Tahun 2021 (Harmonisasi Peraturan Perpajakan)</a></li></ul></div><div><h3>Peraturan Menteri Keuangan (PMK)</h3><ul class="list-disc list-inside text-blue-600"><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/a1d95324-42b7-4c74-8b09-b42023223f05" target="_blank" rel="noopener noreferrer">PMK tentang Nilai Pabean</a></li><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/98b79237-0245-4231-90c7-013143c16a6a" target="_blank" rel="noopener noreferrer">PMK tentang Impor Sementara</a></li><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/a0101083-d343-4e00-9c2b-871d8717906d" target="_blank" rel="noopener noreferrer">PMK tentang Kawasan Berikat</a></li><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/98d0228d-d790-482f-870f-96a84c8a29a4" target="_blank" rel="noopener noreferrer">PMK tentang Pusat Logistik Berikat</a></li><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/32338b2d-4537-4d6d-8533-8947690623a8" target="_blank" rel="noopener noreferrer">PMK tentang KITE</a></li><li><a href="https://jdih.kemenkeu.go.id/in/dokumen/lihat/cda49f69-74d7-4632-841f-13a8d1163473" target="_blank" rel="noopener noreferrer">PMK tentang Sanksi Administrasi Denda</a></li></ul></div><div><h3>Peraturan Menteri Perdagangan (Permendag)</h3><ul class="list-disc list-inside text-blue-600"><li><a href="https://jdih.kemendag.go.id/peraturan/detail/2932/1" target="_blank" rel="noopener noreferrer">Permendag tentang Kebijakan dan Pengaturan Impor</a></li><li><a href="https://jdih.kemendag.go.id/peraturan/detail/1628/1" target="_blank" rel="noopener noreferrer">Permendag tentang Ketentuan Impor Besi atau Baja</a></li></ul></div><div><h3>Peraturan Direktur Jenderal Bea dan Cukai (Perdirjen)</h3><ul class="list-disc list-inside text-blue-600"><li><a href="https://www.beacukai.go.id/arsip/peraturan/2018/peraturan-direktur-jenderal-bea-dan-cukai-nomor-per-19bc2018.html" target="_blank" rel="noopener noreferrer">Perdirjen tentang Petunjuk Pelaksanaan Kawasan Berikat</a></li><li><a href="https://www.beacukai.go.id/arsip/peraturan/2018/peraturan-direktur-jenderal-bea-dan-cukai-nomor-per-20bc2018.html" target="_blank" rel="noopener noreferrer">Perdirjen tentang Tata Laksana Pemasukan dan Pengeluaran Barang ke dan dari Pusat Logistik Berikat</a></li></ul></div></div></div></div>

            <!-- Glosarium Page -->
            <div id="glosarium" class="page-content"><div class="section-card"><h2 data-lang-key="glossary_title">Glosarium Istilah Kepabeanan</h2><div class="card-content space-y-4" data-lang-key="glossary_content"><div><h4 class="font-semibold text-gray-800">Angka Pengenal Importir (API)</h4><p class="text-gray-600">Tanda pengenal yang wajib dimiliki oleh setiap perusahaan yang melakukan kegiatan impor barang.</p></div><div><h4 class="font-semibold text-gray-800">Daerah Pabean</h4><p class="text-gray-600">Wilayah Republik Indonesia yang meliputi darat, perairan, dan ruang udara di atasnya, serta tempat-tempat tertentu di Zona Ekonomi Eksklusif dan landas kontinen yang di dalamnya berlaku Undang-Undang Kepabeanan.</p></div><div><h4 class="font-semibold text-gray-800">De Minimis Value</h4><p class="text-gray-600">Batas nilai pabean atas barang kiriman yang diberikan pembebasan bea masuk. Saat ini ditetapkan sebesar FOB USD 3 per kiriman.</p></div><div><h4 class="font-semibold text-gray-800">HS Code (Harmonized System Code)</h4><p class="text-gray-600">Sistem klasifikasi barang yang digunakan secara internasional untuk mengidentifikasi produk. HS Code menentukan besaran tarif bea masuk suatu barang.</p></div><div><h4 class="font-semibold text-gray-800">Jalur Merah, Kuning, Hijau</h4><p class="text-gray-600">Sistem manajemen risiko DJBC. <strong>Jalur Merah:</strong> Pemeriksaan fisik dan dokumen. <strong>Jalur Kuning:</strong> Hanya pemeriksaan dokumen. <strong>Jalur Hijau:</strong> Tidak ada pemeriksaan, barang dapat langsung keluar.</p></div><div><h4 class="font-semibold text-gray-800">Kawasan Pabean</h4><p class="text-gray-600">Kawasan dengan batas-batas tertentu di pelabuhan laut, bandar udara, atau tempat lain yang ditetapkan untuk lalu lintas barang yang sepenuhnya berada di bawah pengawasan DJBC.</p></div><div><h4 class="font-semibold text-gray-800">Lartas (Larangan dan Pembatasan)</h4><p class="text-gray-600">Barang-barang yang impornya dilarang atau dibatasi dan memerlukan perizinan khusus dari instansi teknis terkait sebelum dapat diimpor.</p></div><div><h4 class="font-semibold text-gray-800">Nilai Pabean</h4><p class="text-gray-600">Nilai transaksi dari barang impor yang digunakan sebagai dasar untuk menghitung bea masuk. Umumnya menggunakan metode CIF (Cost, Insurance, Freight).</p></div><div><h4 class="font-semibold text-gray-800">Nota Pembetulan (Notul)</h4><p class="text-gray-600">Dokumen yang diterbitkan oleh Pejabat Bea Cukai untuk mengoreksi data pada PIB yang menyebabkan kekurangan atau kelebihan pembayaran pungutan negara.</p></div><div><h4 class="font-semibold text-gray-800">Pemberitahuan Ekspor Barang (PEB)</h4><p class="text-gray-600">Dokumen pabean yang digunakan untuk memberitahukan pelaksanaan ekspor barang.</p></div><div><h4 class="font-semibold text-gray-800">Pemberitahuan Impor Barang (PIB)</h4><p class="text-gray-600">Dokumen pemberitahuan yang diajukan oleh importir kepada kantor bea cukai atas barang yang diimpor, berisi detail barang, nilai, dan data lain yang menjadi dasar perhitungan pungutan negara.</p></div></div></div></div>
            
            <!-- Quiz Page -->
            <div id="kuis" class="page-content">
                <div id="quiz-menu" class="section-card">
                    <h2 data-lang-key="quiz_title">Kuis Pabean</h2>
                    <div class="card-content">
                        <p class="mb-6 text-gray-600" data-lang-key="quiz_intro">Uji pengetahuan Anda tentang berbagai aspek kepabeanan. Pilih salah satu kategori di bawah ini untuk memulai.</p>
                        <div id="quiz-category-grid" class="quiz-category-grid">
                            <!-- Categories will be dynamically inserted here by JavaScript -->
                        </div>
                    </div>
                </div>

                <div id="quiz-container" class="hidden">
                    <div class="section-card">
                        <h2 id="quiz-header-title"></h2>
                        <div class="card-content">
                            <div id="quiz-questions-container"></div>
                            <div class="mt-6 flex justify-between items-center">
                                <button id="submit-quiz-btn" class="btn btn-primary text-lg"></button>
                                <button onclick="returnToQuizMenu()" class="btn btn-secondary" data-lang-key="btn_back_to_menu">Kembali ke Menu</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="quiz-results-container" class="section-card hidden">
                    <h2 data-lang-key="quiz_result_title">Hasil Kuis</h2>
                    <div class="card-content text-center">
                        <p class="text-lg font-medium text-gray-700" data-lang-key="quiz_score_label">Skor Anda:</p>
                        <p id="quiz-score" class="text-5xl font-bold my-4 bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-indigo-600"></p>
                        <p id="quiz-summary" class="text-gray-600 mb-6"></p>
                        <button onclick="returnToQuizMenu()" class="btn btn-primary" data-lang-key="btn_back_to_menu">Kembali ke Menu</button>
                    </div>
                </div>
            </div>

        </main>
    </div>
    
    <div id="notification" class=""></div>

<script>
// --- TRANSLATION DATA ---
const translations = {
    "portal_title": {"id": "Portal Informasi Kepabeanan Indonesia", "en": "Indonesian Customs Information Portal"},
    "nav_calculators": {"id": "Kalkulator", "en": "Calculators"},
    "nav_import_quota": {"id": "Kuota Impor", "en": "Import Quota"},
    "nav_facilities": {"id": "Analisis Fasilitas", "en": "Facilities Analysis"},
    "nav_case_studies": {"id": "Studi Kasus", "en": "Case Studies"},
    "nav_regulations": {"id": "Pusat Peraturan", "en": "Regulation Center"},
    "nav_glossary": {"id": "Glosarium", "en": "Glossary"},
    "nav_quiz": {"id": "Kuis Pabean", "en": "Customs Quiz"},
    "kalkulator_pib_title": {"id": "Kalkulator PIB (Termasuk Bea Masuk Anti Dumping)", "en": "Import Declaration Calculator (incl. Anti-Dumping Duty)"},
    "pib_guidance_summary": {"id": "Tampilkan Petunjuk Pengisian", "en": "Show Filling Instructions"},
    "pib_guidance_content": {"id": `<p><strong>Total Insurance:</strong> Masukkan total biaya asuransi pengiriman barang dari luar negeri.</p><p><strong>Total Freight:</strong> Masukkan total biaya pengangkutan/pengiriman barang (ongkos kirim).</p><p><strong>Total Royalty & Lisensi:</strong> Biaya yang harus dibayar sebagai syarat penjualan barang impor (jika ada).</p><p><strong>Total Garansi:</strong> Biaya penggantian atau perbaikan yang ditanggung pembeli (jika ada).</p><p><strong>Total Diskon:</strong> Potongan harga yang didapat dari total nilai barang.</p><p><strong>Cost Barang:</strong> Masukkan harga per-item/per-jenis barang sesuai invoice.</p><p><strong>Tarif BM & BMAD:</strong> Masukkan tarif Bea Masuk dan Bea Masuk Anti Dumping dalam persen (%). Isi 0 jika tidak ada.</p>`, "en": `<p><strong>Total Insurance:</strong> Enter the total insurance cost for shipping the goods from abroad.</p><p><strong>Total Freight:</strong> Enter the total freight cost for shipping the goods.</p><p><strong>Total Royalty & License:</strong> Fees that must be paid as a condition of the sale of imported goods (if any).</p><p><strong>Total Warranty:</strong> Cost of replacement or repair borne by the buyer (if any).</p><p><strong>Total Discount:</strong> Price reduction obtained from the total value of the goods.</p><p><strong>Item Cost:</strong> Enter the price per item/type of goods according to the invoice.</p><p><strong>ID & ADD Tariff:</strong> Enter the Import Duty and Anti-Dumping Duty tariffs in percent (%). Enter 0 if none.</p>`},
    "label_pib_number": {"id": "Nomor PIB", "en": "Import Declaration No."},
    "label_total_insurance": {"id": "Total Insurance (Rp)", "en": "Total Insurance (IDR)"},
    "label_total_freight": {"id": "Total Freight (Rp)", "en": "Total Freight (IDR)"},
    "label_total_royalty": {"id": "Total Royalty & Lisensi (Rp)", "en": "Total Royalty & License (IDR)"},
    "label_total_warranty": {"id": "Total Garansi (Rp)", "en": "Total Warranty (IDR)"},
    "label_total_discount": {"id": "Total Diskon (Rp)", "en": "Total Discount (IDR)"},
    "label_pph_rate": {"id": "Tarif PPh Ps. 22", "en": "Income Tax Art. 22 Rate"},
    "pph_option_1": {"id": "2,5% (Dengan API)", "en": "2.5% (With Importer ID)"},
    "pph_option_2": {"id": "7,5% (Tanpa API)", "en": "7.5% (Without Importer ID)"},
    "pph_option_3": {"id": "10% (Tertentu)", "en": "10% (Specific)"},
    "pph_option_4": {"id": "0,5% (Tertentu)", "en": "0.5% (Specific)"},
    "th_serial": {"id": "Serial", "en": "Serial"},
    "th_item_cost": {"id": "Cost Barang (Rp)", "en": "Item Cost (IDR)"},
    "th_bm_rate": {"id": "Tarif BM (%)", "en": "ID Tariff (%)"},
    "th_bmad_rate": {"id": "Tarif BMAD (%)", "en": "ADD Tariff (%)"},
    "th_action": {"id": "Aksi", "en": "Action"},
    "btn_add_item": {"id": "Tambah Barang", "en": "Add Item"},
    "btn_calculate_pib": {"id": "Hitung & Detailkan PIB", "en": "Calculate & Detail"},
    "btn_reset": {"id": "Reset", "en": "Reset"},
    "pib_result_title": {"id": "Detail Perhitungan PIB", "en": "Import Declaration Calculation Details"},
    "th_customs_value": {"id": "Nilai Pabean", "en": "Customs Value"},
    "th_import_duty": {"id": "Bea Masuk", "en": "Import Duty"},
    "th_add": {"id": "BM Anti Dumping", "en": "Anti-Dumping Duty"},
    "th_import_value": {"id": "Nilai Impor", "en": "Import Value"},
    "th_vat": {"id": "PPN", "en": "VAT"},
    "th_pph22": {"id": "PPh 22", "en": "Income Tax 22"},
    "btn_export_excel": {"id": "Export ke Excel", "en": "Export to Excel"},
    "btn_export_csv": {"id": "Export ke CSV", "en": "Export to CSV"},
    "kalkulator_sanksi_title": {"id": "Kalkulator Sanksi Administrasi", "en": "Administrative Sanction Calculator"},
    "sanksi_placeholder": {"id": "Lengkapi dan hitung detail PIB di atas terlebih dahulu untuk mengaktifkan kalkulator sanksi.", "en": "Complete and calculate the Import Declaration details above to activate the sanction calculator."},
    "label_error_type": {"id": "Jenis Kesalahan", "en": "Type of Error"},
    "error_type_value": {"id": "Kesalahan Nilai Pabean", "en": "Customs Value Error"},
    "error_type_rate": {"id": "Kesalahan Tarif", "en": "Tariff Error"},
    "label_importer_type": {"id": "Jenis Importir", "en": "Importer Type"},
    "importer_type_general": {"id": "Importir Umum", "en": "General Importer"},
    "importer_type_facility": {"id": "Importir Fasilitas (AEO/MITA/Kawasan Berikat/KITE)*", "en": "Facility Importer (AEO/MITA/Bonded Zone/KITE)*"},
    "sanksi_note": {"id": "*Skema denda berjenjang akan diterapkan otomatis sesuai aturan.", "en": "*Tiered fine scheme will be applied automatically according to regulations."},
    "btn_calculate_sanction": {"id": "Hitung Sanksi", "en": "Calculate Sanction"},
    "sanksi_result_paid": {"id": "Total BM Dibayar", "en": "Total Import Duty Paid"},
    "sanksi_result_should_be": {"id": "Total BM Seharusnya", "en": "Total Import Duty Should Be"},
    "sanksi_result_shortage": {"id": "Kekurangan Pembayaran BM", "en": "Import Duty Shortage"},
    "sanksi_result_percentage": {"id": "Persentase Kekurangan", "en": "Shortage Percentage"},
    "sanksi_result_applicable_rate": {"id": "Tarif Denda Berlaku", "en": "Applicable Fine Rate"},
    "sanksi_result_total_fine": {"id": "Total Denda", "en": "Total Fine"},
    "temp_import_desc": {"id": "Simulasikan pembayaran untuk impor sementara. Masukkan total pungutan yang seharusnya dibayar jika impor biasa, dan jangka waktu penggunaan.", "en": "Simulate payments for temporary import. Enter the total levies that should be paid for a regular import, and the period of use."},
    "label_total_bm_should_be": {"id": "Total Bea Masuk Seharusnya (Rp)", "en": "Total Import Duty Should Be (IDR)"},
    "label_total_vat_should_be": {"id": "Total PPN Seharusnya (Rp)", "en": "Total VAT Should Be (IDR)"},
    "label_total_pph_should_be": {"id": "Total PPh 22 Seharusnya (Rp)", "en": "Total Income Tax 22 Should Be (IDR)"},
    "label_period_months": {"id": "Jangka Waktu (Bulan)", "en": "Period (Months)"},
    "btn_calculate_temp_import": {"id": "Hitung Impor Sementara", "en": "Calculate Temporary Import"},
    "temp_import_total_levies": {"id": "Total Pungutan Seharusnya", "en": "Total Levies Should Be"},
    "temp_import_monthly_payment": {"id": "Pembayaran per Bulan (2%)", "en": "Payment per Month (2%)"},
    "temp_import_total_payment": {"id": "Total Bayar Impor Sementara", "en": "Total Temporary Import Payment"},
    "quota_title": {"id": "Syarat Kuota Impor (Permendag 16-24 Tahun 2025)", "en": "Import Quota Requirements (Minister of Trade Reg. 16-24 of 2025)"},
    "facilities_title": {"id": "Analisis Fasilitas Kepabeanan", "en": "Customs Facilities Analysis"},
    "case_studies_title": {"id": "Studi Kasus Kepabeanan", "en": "Customs Case Studies"},
    "regulations_title": {"id": "Pusat Peraturan", "en": "Regulation Center"},
    "glossary_title": {"id": "Glosarium Istilah Kepabeanan", "en": "Glossary of Customs Terms"},
    "quiz_title": {"id": "Kuis Pabean", "en": "Customs Quiz"},
    "quiz_intro": {"id": "Uji pengetahuan Anda tentang berbagai aspek kepabeanan. Pilih salah satu kategori di bawah ini untuk memulai.", "en": "Test your knowledge on various customs aspects. Choose a category below to start."},
    "btn_back_to_menu": {"id": "Kembali ke Menu", "en": "Back to Menu"},
    "quiz_result_title": {"id": "Hasil Kuis", "en": "Quiz Results"},
    "quiz_score_label": {"id": "Skor Anda:", "en": "Your Score:"},
    "btn_submit_quiz": {"id": "Kumpulkan Jawaban", "en": "Submit Answers"},
    "quiz_cat_1_title": {"id": "UU Kepabeanan", "en": "Customs Law"},
    "quiz_cat_1_desc": {"id": "60 Soal Pilihan Ganda mengenai UU No. 17 Tahun 2006.", "en": "60 Multiple Choice questions about Law No. 17 of 2006."},
    "quiz_cat_2_title": {"id": "Pengeluaran Barang Impor", "en": "Release of Imported Goods"},
    "quiz_cat_2_desc": {"id": "60 Soal Pilihan Ganda mengenai PMK 190/2022 & PER-2/BC/2023.", "en": "60 Multiple Choice questions about PMK 190/2022 & PER-2/BC/2023."},
    "quiz_cat_3_title": {"id": "Nilai Pabean", "en": "Customs Value"},
    "quiz_cat_3_desc": {"id": "60 Soal Pilihan Ganda mengenai PMK 144/2022.", "en": "60 Multiple Choice questions about PMK 144/2022."},
    "quiz_cat_4_title": {"id": "Impor Barang Kiriman", "en": "Import of Shipped Goods"},
    "quiz_cat_4_desc": {"id": "60 Soal Pilihan Ganda mengenai impor melalui PJT.", "en": "60 Multiple Choice questions about import via couriers."},
    "quiz_cat_5_title": {"id": "Tatalaksana Ekspor", "en": "Export Procedures"},
    "quiz_cat_5_desc": {"id": "60 Soal Pilihan Ganda mengenai PMK 155/2022.", "en": "60 Multiple Choice questions about PMK 155/2022."},
    "quiz_cat_6_title": {"id": "Tempat Penimbunan Berikat", "en": "Bonded Storage Places"},
    "quiz_cat_6_desc": {"id": "60 Soal Pilihan Ganda mengenai KB, GB, PLB, dll.", "en": "60 Multiple Choice questions about KB, GB, PLB, etc."},
    "quiz_cat_7_title": {"id": "Fasilitas Kepabeanan", "en": "Customs Facilities"},
    "quiz_cat_7_desc": {"id": "60 Soal Pilihan Ganda mengenai KITE, AEO, MITA, dll.", "en": "60 Multiple Choice questions about KITE, AEO, MITA, etc."},
    "quiz_cat_8_title": {"id": "Soal Hitungan", "en": "Calculation Problems"},
    "quiz_cat_8_desc": {"id": "10 Soal Esai mengenai perhitungan nilai pabean, BM, dan PDRI.", "en": "10 Essay problems on calculating customs value, duties, and taxes."},
    "quiz_cat_9_title": {"id": "Klasifikasi Barang", "en": "Goods Classification"},
    "quiz_cat_9_desc": {"id": "10 Soal Esai mengenai penetapan HS Code.", "en": "10 Essay problems on determining HS Code."}
};

// --- QUIZ DATA ---
const quizData = {
    cat1: {
        type: 'mcq',
        questions: [
            { q: "Wilayah Indonesia yang di dalamnya berlaku UU Kepabeanan disebut...", a: ["Daerah Pabean", "Kawasan Pabean", "Zona Ekonomi Eksklusif", "Landas Kontinen"], correct: 0 },
            { q: "Audit Kepabeanan dilakukan oleh...", a: ["Pejabat Bea dan Cukai", "Direktorat Jenderal Pajak", "Unit Audit Internal DJBC", "Auditor Eksternal"], correct: 2 },
        ]
    },
    cat2: {
        type: 'mcq',
        questions: [
            { q: "Dokumen yang digunakan untuk pengeluaran barang impor untuk dipakai adalah...", a: ["PEB", "PIB", "BC 2.3", "BC 4.0"], correct: 1 },
        ]
    },
    cat3: {
        type: 'mcq',
        questions: [
            { q: "Metode utama yang digunakan untuk menetapkan nilai pabean adalah...", a: ["Metode Deduksi", "Metode Komputasi", "Nilai Transaksi", "Metode Fallback"], correct: 2 },
        ]
    },
    cat4: {
        type: 'mcq',
        questions: [
            { q: "Batas nilai pembebasan bea masuk untuk barang kiriman per kiriman saat ini adalah...", a: ["FOB USD 3", "FOB USD 75", "FOB USD 500", "FOB USD 1500"], correct: 0 },
        ]
    },
    cat5: {
        type: 'mcq',
        questions: [
            { q: "Pemberitahuan pabean ekspor disampaikan melalui dokumen...", a: ["PIB", "PEB", "BC 3.0", "Nota Pelayanan Ekspor"], correct: 1 },
        ]
    },
    cat6: {
        type: 'mcq',
        questions: [
            { q: "Tempat penimbunan untuk mengolah barang yang hasilnya terutama untuk diekspor adalah...", a: ["Gudang Berikat", "Pusat Logistik Berikat", "Kawasan Berikat", "Toko Bebas Bea"], correct: 2 },
        ]
    },
    cat7: {
        type: 'mcq',
        questions: [
            { q: "Fasilitas pembebasan bea masuk atas impor bahan baku untuk tujuan ekspor dikenal sebagai...", a: ["AEO", "MITA", "KITE", "Kawasan Bebas"], correct: 2 },
        ]
    },
    cat8: {
        type: 'essay',
        questions: [
            { q: "Importir PT. Jaya mengimpor 100 unit mesin dari Jerman dengan harga FOB EUR 1,000 per unit. Biaya asuransi adalah 0.5% dari nilai FOB dan biaya angkut (freight) adalah EUR 2,000. Kurs yang ditetapkan Menteri Keuangan adalah 1 EUR = Rp 17,000. Tarif Bea Masuk adalah 10%. Hitunglah Nilai Pabean dan Bea Masuk yang harus dibayar!", modelAnswer: "1. Hitung Total FOB: 100 unit * EUR 1,000 = EUR 100,000.\n2. Hitung Insurance: 0.5% * EUR 100,000 = EUR 500.\n3. Hitung CIF (Cost, Insurance, Freight): EUR 100,000 + EUR 500 + EUR 2,000 = EUR 102,500.\n4. Hitung Nilai Pabean (NP): EUR 102,500 * Rp 17,000 = Rp 1,742,500,000.\n5. Hitung Bea Masuk (BM): 10% * Rp 1,742,500,000 = Rp 174,250,000. Pembulatan PIB: Rp 174,250,000." },
        ]
    },
    cat9: {
        type: 'essay',
        questions: [
            { q: "Sebuah perusahaan mengimpor 'smartphone' yang memiliki fungsi telepon, akses internet, kamera, dan GPS. Jelaskan pertimbangan Anda dalam menetapkan HS Code untuk barang tersebut dan sebutkan pos yang paling mungkin.", modelAnswer: "Berdasarkan Ketentuan Umum Menginterpretasi Harmonized System (KUMHS) nomor 3(a), pos yang memberikan uraian paling spesifik harus lebih diutamakan. Namun, smartphone adalah barang multifungsi. KUMHS 3(c) menyatakan jika tidak dapat diklasifikasikan dengan 3(a) atau 3(b), barang harus diklasifikasikan dalam pos yang muncul terakhir dalam urutan numerik di antara pos-pos yang punya pertimbangan yang sama. Fungsi utamanya adalah sebagai 'Aparatus telepon untuk jaringan seluler'. Oleh karena itu, HS Code yang paling mungkin adalah 8517.13.00 (Telepon untuk jaringan seluler atau untuk jaringan nirkabel lainnya - Telepon pintar)." },
        ]
    }
};

// --- NAVIGATION ---
function showPage(pageId) {
    document.querySelectorAll('.page-content').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    
    document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
    document.querySelector(`.nav-link[onclick="showPage('${pageId}')"]`).classList.add('active');
    
    if (pageId === 'kuis') {
        returnToQuizMenu();
    }
}

// --- LANGUAGE SWITCHER ---
function setLanguage(lang) {
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-lang-key]').forEach(el => {
        const key = el.dataset.langKey;
        if (translations[key] && translations[key][lang]) {
            el.innerHTML = translations[key][lang];
        }
    });
    if (lang === 'id') {
        document.getElementById('lang-id').classList.add('active');
        document.getElementById('lang-en').classList.remove('active');
    } else {
        document.getElementById('lang-en').classList.add('active');
        document.getElementById('lang-id').classList.remove('active');
    }
    // Re-populate quiz menu on language change
    populateQuizMenu();
}


// --- CALCULATOR LOGIC (Existing) ---
document.addEventListener('DOMContentLoaded', function() {
    const itemsContainer = document.getElementById('items-container');
    const addItemBtn = document.getElementById('add-item-btn');

    function updateSerialNumbers() {
        const rows = itemsContainer.querySelectorAll('.item-row');
        rows.forEach((row, index) => {
            row.querySelector('.serial-number').textContent = index + 1;
        });
    }

    function createItemRow() {
        const itemRow = document.createElement('div');
        itemRow.className = 'item-row border-b md:border-none md:grid md:grid-cols-12 gap-4 p-4 md:p-2';
        itemRow.innerHTML = `
            <div class="font-semibold md:col-span-1 flex items-center">
                <span class="serial-number mr-2"></span>
                <span class="md:hidden font-bold">Barang</span>
            </div>
            <div class="md:col-span-5">
                <label class="block text-sm font-medium text-gray-700 mb-1 md:hidden">Cost Barang (Rp)</label>
                <input type="text" class="input-field number-input item-cost" placeholder="15.000.000" inputmode="numeric">
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1 md:hidden">Tarif BM (%)</label>
                <input type="number" class="input-field item-bm-tarif" placeholder="7.5" inputmode="decimal">
            </div>
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1 md:hidden">Tarif BMAD (%)</label>
                <input type="number" class="input-field item-bmad-tarif" placeholder="0" inputmode="decimal">
            </div>
            <div class="md:col-span-2 mt-2 md:mt-0">
                <button class="btn btn-danger w-full md:w-auto remove-item-btn"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 md:mr-0" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 10a.75.75 0 01.75-.75h10.5a.75.75 0 010 1.5H4.75A.75.75 0 014 10z" clip-rule="evenodd" /></svg><span class="md:hidden">Hapus Barang</span></button>
            </div>
        `;
        itemsContainer.appendChild(itemRow);
        
        itemRow.querySelector('.remove-item-btn').addEventListener('click', function() {
            itemRow.remove();
            updateSerialNumbers();
        });
        
        addNumberFormatting(itemRow.querySelector('.number-input'));
        updateSerialNumbers();
    }
    
    document.querySelectorAll('.number-input').forEach(addNumberFormatting);
    
    if(addItemBtn) {
        createItemRow();
        addItemBtn.addEventListener('click', createItemRow);
    }
    
    setLanguage('id'); // Set default language
    populateQuizMenu(); // Populate quiz menu on initial load
});


function addNumberFormatting(inputElement) {
    if (!inputElement) return;
    inputElement.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, '');
        e.target.value = value ? new Intl.NumberFormat('id-ID').format(value) : '';
    });
}

function unformatNumber(formattedValue) {
    if (typeof formattedValue !== 'string') return 0;
    return formattedValue.replace(/[^0-9,-]/g, '').replace(/,.*$/, '');
}

function formatRupiah(number, includeSymbol = true) {
    if(includeSymbol) {
        return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(Math.round(number));
    }
    return new Intl.NumberFormat('id-ID').format(Math.round(number));
}


function getFloatValue(id) {
    const element = document.getElementById(id);
    const value = element.value;
    if (id === 'main-pph-tarif') {
        return parseFloat(value) || 0;
    }
    return parseFloat(unformatNumber(value)) || 0;
}


function getFloatValueFromElement(element) {
    if (!element) return 0;
    if (element.classList.contains('number-input')) {
        return parseFloat(unformatNumber(element.value)) || 0;
    }
    return parseFloat(element.value) || 0;
}

function calculateMain() {
    const pphTarif = getFloatValue('main-pph-tarif'); 
    const shipmentAdditions = getFloatValue('main-insurance') + getFloatValue('main-freight') + getFloatValue('main-royalty') + getFloatValue('main-warranty');
    const totalDiscount = getFloatValue('main-discount');
    const items = document.querySelectorAll('#items-container .item-row');

    if (items.length === 0) { alert('Mohon tambahkan setidaknya satu barang.'); return; }
    
    let grandTotalCost = 0;
    items.forEach(row => { grandTotalCost += getFloatValueFromElement(row.querySelector('.item-cost')); });

    if (grandTotalCost === 0) { alert('Total Cost barang tidak boleh nol.'); return; }

    const resultsBody = document.getElementById('pib-results-body');
    const resultsFoot = document.getElementById('pib-results-foot');
    const explanationDiv = document.getElementById('pib-calculation-explanation');
    resultsBody.innerHTML = '';
    explanationDiv.innerHTML = '<h3>Rincian Proses Perhitungan</h3>';
    
    let totalBMUnrounded = 0;
    let totalBMADUnrounded = 0;
    let total = { np: 0, ni: 0, ppn: 0, pph: 0 };

    items.forEach((row, index) => {
        const serial = index + 1;
        const itemCost = getFloatValueFromElement(row.querySelector('.item-cost'));
        const itemBMTarif = getFloatValueFromElement(row.querySelector('.item-bm-tarif')) / 100;
        const itemBMADTarif = getFloatValueFromElement(row.querySelector('.item-bmad-tarif')) / 100;
        
        const costProportion = grandTotalCost > 0 ? itemCost / grandTotalCost : 0;
        const apportionedAdditions = shipmentAdditions * costProportion;
        const apportionedDiscount = totalDiscount * costProportion;
        
        const np = (itemCost + apportionedAdditions) - apportionedDiscount;
        const bmUnrounded = np * itemBMTarif;
        const bmadUnrounded = np * itemBMADTarif;
        
        totalBMUnrounded += bmUnrounded;
        totalBMADUnrounded += bmadUnrounded;
        
        const ni = np + bmUnrounded;
        const ppn = Math.floor(ni * 0.11);
        const niBasisPph = Math.floor(ni / 1000) * 1000;
        const pph = Math.floor(niBasisPph * pphTarif);

        total.np += np;
        total.ni += ni;
        total.ppn += ppn;
        total.pph += pph;

        const resultRow = document.createElement('tr');
        resultRow.innerHTML = `
            <td>${serial}</td>
            <td class="text-right">${formatRupiah(np)}</td>
            <td class="text-right">${formatRupiah(bmUnrounded)}</td>
            <td class="text-right">${formatRupiah(bmadUnrounded)}</td>
            <td class="text-right">${formatRupiah(ni)}</td>
            <td class="text-right">${formatRupiah(ppn)}</td>
            <td class="text-right">${formatRupiah(pph)}</td>
        `;
        resultsBody.appendChild(resultRow);
        
        explanationDiv.innerHTML += `
            <div class="mb-4 p-2 border-l-4 border-blue-500">
                <p class="font-semibold">Barang #${serial}:</p>
                <p class="text-sm"><strong>Nilai Pabean:</strong> (${formatRupiah(itemCost, false)} + ${formatRupiah(apportionedAdditions, false)}) - ${formatRupiah(apportionedDiscount, false)} = <strong>${formatRupiah(np)}</strong></p>
                <p class="text-sm"><strong>Bea Masuk:</strong> ${formatRupiah(np)} x ${itemBMTarif*100}% = <strong>${formatRupiah(bmUnrounded)}</strong></p>
                <p class="text-sm"><strong>Nilai Impor (Dasar PDRI):</strong> ${formatRupiah(np)} + ${formatRupiah(bmUnrounded)} = <strong>${formatRupiah(ni)}</strong></p>
                <p class="text-sm"><strong>PPN:</strong> ${formatRupiah(ni)} x 11% = ${formatRupiah(ni*0.11)} -> dibulatkan menjadi <strong>${formatRupiah(ppn)}</strong></p>
                <p class="text-sm"><strong>PPh 22:</strong> (Dasar: ${formatRupiah(niBasisPph)}) x ${pphTarif*100}% = ${formatRupiah(niBasisPph*pphTarif)} -> dibulatkan menjadi <strong>${formatRupiah(pph)}</strong></p>
            </div>
        `;
    });
    
    const totalBMRounded = Math.ceil(totalBMUnrounded / 1000) * 1000;
    const totalBMADRounded = Math.ceil(totalBMADUnrounded / 1000) * 1000;

    explanationDiv.innerHTML += `
        <div class="mt-4 p-2 border-t-2 border-gray-200">
            <p class="font-semibold">Total Pungutan (dengan Pembulatan PIB):</p>
            <p class="text-sm"><strong>Total Bea Masuk:</strong> ${formatRupiah(totalBMUnrounded)} -> dibulatkan ke atas menjadi <strong>${formatRupiah(totalBMRounded)}</strong></p>
            <p class="text-sm"><strong>Total BM Anti Dumping:</strong> ${formatRupiah(totalBMADUnrounded)} -> dibulatkan ke atas menjadi <strong>${formatRupiah(totalBMADRounded)}</strong></p>
        </div>
    `;

    resultsFoot.innerHTML = `
        <tr>
            <td class="font-bold">TOTAL</td>
            <td class="text-right">${formatRupiah(total.np)}</td>
            <td class="text-right">${formatRupiah(totalBMRounded)}</td>
            <td class="text-right">${formatRupiah(totalBMADRounded)}</td>
            <td class="text-right">${formatRupiah(total.ni)}</td>
            <td class="text-right">${formatRupiah(total.ppn)}</td>
            <td class="text-right">${formatRupiah(total.pph)}</td>
        </tr>
    `;
    
    document.getElementById('pib-results-detail').classList.remove('hidden');
    document.getElementById('pib-calculation-explanation').classList.remove('hidden');
    document.getElementById('sanksi-placeholder').classList.add('hidden');
    document.getElementById('sanksi-content').classList.remove('hidden');
    populateSanksiCalculator();
}


function resetMain() {
    ['pib-number', 'main-insurance', 'main-freight', 'main-royalty', 'main-warranty', 'main-discount'].forEach(id => { document.getElementById(id).value = ''; });
    document.getElementById('main-pph-tarif').value = '0.025';
    document.getElementById('items-container').innerHTML = '';
    document.getElementById('add-item-btn').click();
    document.getElementById('pib-results-detail').classList.add('hidden');
    document.getElementById('pib-calculation-explanation').classList.add('hidden');
    
    document.getElementById('sanksi-content').classList.add('hidden');
    document.getElementById('sanksi-placeholder').classList.remove('hidden');
    document.getElementById('sanksi-result-container').classList.add('hidden');
}

function populateSanksiCalculator() {
    const sanksiItemsContainer = document.getElementById('sanksi-items-container');
    sanksiItemsContainer.innerHTML = '';
    const pibResults = document.querySelectorAll('#pib-results-body tr');

    pibResults.forEach((pibResultRow, index) => {
        const serial = index + 1;
        const npDeklarasi = pibResultRow.cells[1].innerText;
        
        const row = document.createElement('tr');
        row.dataset.serial = serial;
        row.innerHTML = `
            <td>${serial}</td>
            <td class="text-right">${npDeklarasi}</td>
            <td class="sanksi-input-np"><input type="text" class="input-field number-input" placeholder="Masukkan NP Seharusnya" inputmode="numeric"></td>
            <td class="sanksi-input-tarif hidden"><input type="number" class="input-field" placeholder="Masukkan Tarif BM Seharusnya (%)" inputmode="decimal"></td>
        `;
        sanksiItemsContainer.appendChild(row);
        addNumberFormatting(row.querySelector('.number-input'));
    });
    toggleSanksiInput(); 
}

function toggleSanksiInput() {
    const sanksiTable = document.getElementById('sanksi-input-table');
    const header = sanksiTable.querySelector('thead');
    const jenis = document.getElementById('sanksi-jenis-pelanggaran').value;

    if (jenis === 'nilai_pabean') {
        header.innerHTML = `<tr><th>Serial</th><th class="text-right">NP Deklarasi</th><th class="text-right">NP Seharusnya (Rp)</th></tr>`;
        document.querySelectorAll('.sanksi-input-np').forEach(el => el.classList.remove('hidden'));
        document.querySelectorAll('.sanksi-input-tarif').forEach(el => el.classList.add('hidden'));
    } else { 
        header.innerHTML = `<tr><th>Serial</th><th class="text-right">NP Deklarasi</th><th class="text-right">Tarif BM Seharusnya (%)</th></tr>`;
        document.querySelectorAll('.sanksi-input-np').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.sanksi-input-tarif').forEach(el => el.classList.remove('hidden'));
    }
}


function calculateSanksi() {
    const jenisKesalahan = document.getElementById('sanksi-jenis-pelanggaran').value;
    const jenisImportir = document.getElementById('sanksi-jenis-importir').value;
    const sanksiItems = document.querySelectorAll('#sanksi-items-container tr');
    const pibItems = document.querySelectorAll('#items-container .item-row');
    const totalBMDibayarRounded = parseFloat(unformatNumber(document.querySelector('#pib-results-foot tr').cells[2].innerText));

    let totalBMSeharusnyaUnrounded = 0;

    sanksiItems.forEach((row, index) => {
        const npDeklarasiText = row.cells[1].innerText;
        const npDeklarasi = parseFloat(unformatNumber(npDeklarasiText));
        
        let bmSeharusnya = 0;
        if (jenisKesalahan === 'nilai_pabean') {
            const npSeharusnya = getFloatValueFromElement(row.querySelector('.sanksi-input-np input'));
            const tarifBMDeklarasi = getFloatValueFromElement(pibItems[index].querySelector('.item-bm-tarif')) / 100;
            bmSeharusnya = npSeharusnya * tarifBMDeklarasi;
        } else {
            const tarifBMSeharusnya = getFloatValueFromElement(row.querySelector('.sanksi-input-tarif input')) / 100;
            bmSeharusnya = npDeklarasi * tarifBMSeharusnya;
        }
        totalBMSeharusnyaUnrounded += bmSeharusnya;
    });

    const totalBMSeharusnyaRounded = Math.ceil(totalBMSeharusnyaUnrounded / 1000) * 1000;
    
    if (totalBMSeharusnyaRounded < totalBMDibayarRounded) {
        alert('Total BM Seharusnya tidak boleh lebih kecil dari yang sudah dibayar.');
        return;
    }

    const kekuranganBayar = totalBMSeharusnyaRounded - totalBMDibayarRounded;
    let persentaseKekurangan = 0;
    if (totalBMDibayarRounded > 0) {
        persentaseKekurangan = (kekuranganBayar / totalBMDibayarRounded) * 100;
    } else if (kekuranganBayar > 0) {
        persentaseKekurangan = Infinity;
    }

    let tarifDenda = 0;
    if (jenisImportir === 'umum') {
        if (persentaseKekurangan <= 25) tarifDenda = 100;
        else if (persentaseKekurangan <= 50) tarifDenda = 200;
        else if (persentaseKekurangan <= 75) tarifDenda = 300;
        else if (persentaseKekurangan <= 100) tarifDenda = 400;
        else if (persentaseKekurangan <= 125) tarifDenda = 500;
        else if (persentaseKekurangan <= 150) tarifDenda = 600;
        else if (persentaseKekurangan <= 175) tarifDenda = 700;
        else if (persentaseKekurangan <= 200) tarifDenda = 800;
        else if (persentaseKekurangan <= 225) tarifDenda = 900;
        else tarifDenda = 1000;
    } else { 
        if (persentaseKekurangan <= 20) tarifDenda = 100;
        else if (persentaseKekurangan <= 40) tarifDenda = 200;
        else if (persentaseKekurangan <= 60) tarifDenda = 300;
        else if (persentaseKekurangan <= 80) tarifDenda = 400;
        else tarifDenda = 500;
    }
    
    const denda = kekuranganBayar * (tarifDenda / 100);

    document.getElementById('sanksi-total-bm-dibayar').innerText = formatRupiah(totalBMDibayarRounded);
    document.getElementById('sanksi-total-bm-seharusnya').innerText = formatRupiah(totalBMSeharusnyaRounded);
    document.getElementById('sanksi-result-kurang').innerText = formatRupiah(kekuranganBayar);
    document.getElementById('sanksi-result-persen').innerText = `${persentaseKekurangan.toFixed(2)}%`;
    document.getElementById('sanksi-result-tarif').innerText = `${tarifDenda}%`;
    document.getElementById('sanksi-result-denda').innerText = formatRupiah(denda);
    document.getElementById('sanksi-result-container').classList.remove('hidden');
}

function calculateImporSementara() {
    const bm = getFloatValue('is-bm');
    const ppn = getFloatValue('is-ppn');
    const pph = getFloatValue('is-pph');
    const jangkaWaktu = getFloatValue('is-jw');

    if (bm === 0 || jangkaWaktu === 0) {
        alert("Mohon isi total pungutan dan jangka waktu.");
        return;
    }
    
    const totalPungutan = bm + ppn + pph;
    const perBulan = totalPungutan * 0.02; // 2%
    const totalBayar = perBulan * jangkaWaktu;

    document.getElementById('is-total-pungutan').innerText = formatRupiah(totalPungutan);
    document.getElementById('is-per-bulan').innerText = formatRupiah(perBulan);
    document.getElementById('is-total-bayar').innerText = formatRupiah(totalBayar);
    document.getElementById('is-result-container').classList.remove('hidden');
}


// --- EXPORT FUNCTIONS ---

function exportPIB(type) {
    const pibNumber = document.getElementById('pib-number').value || 'data_pib';
    const table = document.getElementById('pib-results-table');
    const wb = XLSX.utils.table_to_book(table, {sheet: "DetailPIB"});
    
    if (type === 'xlsx') {
        XLSX.writeFile(wb, `${pibNumber}.xlsx`);
    } else if (type === 'csv') {
        const csv = XLSX.utils.sheet_to_csv(wb.Sheets.DetailPIB);
        downloadFile(csv, `${pibNumber}.csv`, 'text/csv');
    }
}

function exportSanksi(type) {
    const pibNumber = document.getElementById('pib-number').value || 'data_pib';
    const filename = `sanksi_${pibNumber}`;
    
    const data = [
        ["Keterangan", "Nilai"],
        ["Total BM Dibayar", unformatNumber(document.getElementById('sanksi-total-bm-dibayar').innerText)],
        ["Total BM Seharusnya", unformatNumber(document.getElementById('sanksi-total-bm-seharusnya').innerText)],
        ["Kekurangan Pembayaran BM", unformatNumber(document.getElementById('sanksi-result-kurang').innerText)],
        ["Persentase Kekurangan (%)", document.getElementById('sanksi-result-persen').innerText.replace('%', '')],
        ["Tarif Denda Berlaku (%)", document.getElementById('sanksi-result-tarif').innerText.replace('%', '')],
        ["Total Denda", unformatNumber(document.getElementById('sanksi-result-denda').innerText)]
    ];

    const ws = XLSX.utils.aoa_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "RingkasanSanksi");

    if (type === 'xlsx') {
        XLSX.writeFile(wb, `${filename}.xlsx`);
    } else if (type === 'csv') {
        const csv = XLSX.utils.sheet_to_csv(ws);
        downloadFile(csv, `${filename}.csv`, 'text/csv');
    }
}

function downloadFile(content, fileName, mimeType) {
    const a = document.createElement('a');
    const blob = new Blob([content], { type: mimeType });
    a.href= URL.createObjectURL(blob);
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}

// --- QUIZ FUNCTIONS ---
let currentQuizCategory = null;

function populateQuizMenu() {
    const grid = document.getElementById('quiz-category-grid');
    grid.innerHTML = '';
    const lang = document.documentElement.lang || 'id';

    for (let i = 1; i <= 9; i++) {
        const catKey = `cat${i}`;
        const titleKey = `quiz_cat_${i}_title`;
        const descKey = `quiz_cat_${i}_desc`;
        
        const title = translations[titleKey] ? translations[titleKey][lang] : `Category ${i}`;
        const description = translations[descKey] ? translations[descKey][lang] : `Description for category ${i}`;

        const card = document.createElement('div');
        card.className = 'quiz-category-card';
        card.onclick = () => startQuiz(catKey);
        card.innerHTML = `
            <h3 class="text-xl font-bold text-gray-800 mb-2">${title}</h3>
            <p class="text-gray-500">${description}</p>
        `;
        grid.appendChild(card);
    }
}

function startQuiz(categoryKey) {
    currentQuizCategory = categoryKey;
    const quiz = quizData[categoryKey];
    const lang = document.documentElement.lang || 'id';
    
    document.getElementById('quiz-menu').classList.add('hidden');
    document.getElementById('quiz-results-container').classList.add('hidden');
    
    const quizContainer = document.getElementById('quiz-container');
    const questionsContainer = document.getElementById('quiz-questions-container');
    const titleEl = document.getElementById('quiz-header-title');
    const submitBtn = document.getElementById('submit-quiz-btn');
    
    titleEl.textContent = translations[`quiz_cat_${categoryKey.substring(3)}_title`][lang];
    submitBtn.textContent = translations['btn_submit_quiz'][lang];
    questionsContainer.innerHTML = '';

    quiz.questions.forEach((q, index) => {
        const questionDiv = document.createElement('div');
        questionDiv.className = 'quiz-question';
        questionDiv.innerHTML = `<p class="font-semibold text-lg mb-4">${index + 1}. ${q.q}</p>`;

        if (quiz.type === 'mcq') {
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'quiz-options space-y-2';
            const shuffledOptions = [...q.a].map(value => ({ value, sort: Math.random() })).sort((a, b) => a.sort - b.sort).map(({ value }) => value);

            shuffledOptions.forEach(option => {
                optionsDiv.innerHTML += `
                    <label>
                        <input type="radio" name="q${index}" value="${option}">
                        <span>${option}</span>
                    </label>
                `;
            });
            questionDiv.appendChild(optionsDiv);
        } else if (quiz.type === 'essay') {
            questionDiv.innerHTML += `
                <textarea class="input-field essay-answer" placeholder="Ketik jawaban Anda di sini..."></textarea>
                <div class="model-answer hidden">
                    <h4 class="font-bold mb-2">Kunci Jawaban:</h4>
                    <p>${q.modelAnswer.replace(/\n/g, '<br>')}</p>
                </div>
            `;
        }
        questionsContainer.appendChild(questionDiv);
    });

    submitBtn.onclick = submitQuiz;
    quizContainer.classList.remove('hidden');
}

function submitQuiz() {
    const quiz = quizData[currentQuizCategory];
    const questions = document.querySelectorAll('#quiz-questions-container .quiz-question');
    
    if (quiz.type === 'mcq') {
        let score = 0;
        questions.forEach((qEl, index) => {
            const originalQuestion = quiz.questions[index];
            const correctAnswer = originalQuestion.a[originalQuestion.correct];
            const selectedRadio = qEl.querySelector('input[type="radio"]:checked');
            
            qEl.querySelectorAll('label').forEach(label => {
                const radio = label.querySelector('input');
                const span = label.querySelector('span');
                
                // Disable all radios after submission
                radio.disabled = true;
                
                // Highlight correct answer
                if (span.textContent === correctAnswer) {
                    label.classList.add('correct-answer');
                }
                
                // Check if user selected this option
                if (radio.checked) {
                    if (span.textContent === correctAnswer) {
                        score++;
                    } else {
                        label.classList.add('wrong-answer');
                    }
                }
            });
        });
        showMCQResults(score, questions.length);
    } else if (quiz.type === 'essay') {
        questions.forEach(qEl => {
            qEl.querySelector('textarea').disabled = true;
            qEl.querySelector('.model-answer').classList.remove('hidden');
        });
        document.getElementById('submit-quiz-btn').classList.add('hidden');
    }
}

function showMCQResults(score, total) {
    document.getElementById('quiz-container').classList.add('hidden');
    document.getElementById('quiz-results-container').classList.remove('hidden');
    
    const percentage = Math.round((score / total) * 100);
    document.getElementById('quiz-score').textContent = `${percentage}%`;
    document.getElementById('quiz-summary').textContent = `Anda menjawab dengan benar ${score} dari ${total} soal.`;
}

function returnToQuizMenu() {
    document.getElementById('quiz-container').classList.add('hidden');
    document.getElementById('quiz-results-container').classList.add('hidden');
    document.getElementById('quiz-menu').classList.remove('hidden');
    document.getElementById('submit-quiz-btn').classList.remove('hidden');
}

</script>
</body>
</html>
